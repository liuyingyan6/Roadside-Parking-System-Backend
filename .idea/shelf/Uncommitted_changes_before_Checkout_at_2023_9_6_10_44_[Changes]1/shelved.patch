Index: parkingsys-operator/src/main/java/com/woniuxy/operator/controller/UrlPermissionController.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.woniuxy.operator.controller;\r\n\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.web.bind.annotation.*;\r\nimport java.util.List;\r\nimport com.woniuxy.operator.entity.UrlPermission;\r\nimport com.woniuxy.operator.service.IUrlPermissionService;\r\nimport org.springframework.web.bind.annotation.RestController;\r\n\r\n/**\r\n * <p>\r\n * 菜单和接口权限定义 前端控制器\r\n * </p>\r\n *\r\n * @author woniuxy\r\n * @since 2023-09-02\r\n */\r\n@RestController\r\n@RequestMapping(\"/url-permission\")\r\npublic class UrlPermissionController {\r\n\r\n    private final IUrlPermissionService urlPermissionServiceImpl;\r\n\r\n    public UrlPermissionController(IUrlPermissionService urlPermissionServiceImpl){\r\n        this.urlPermissionServiceImpl = urlPermissionServiceImpl;\r\n    }\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/parkingsys-operator/src/main/java/com/woniuxy/operator/controller/UrlPermissionController.java b/parkingsys-operator/src/main/java/com/woniuxy/operator/controller/UrlPermissionController.java
--- a/parkingsys-operator/src/main/java/com/woniuxy/operator/controller/UrlPermissionController.java	
+++ b/parkingsys-operator/src/main/java/com/woniuxy/operator/controller/UrlPermissionController.java	
@@ -1,5 +1,7 @@
 package com.woniuxy.operator.controller;
 
+import com.woniuxy.operator.pojos.ResponseResult;
+import com.woniuxy.operator.vo.PermissionMenuVO;
 import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.web.bind.annotation.*;
 import java.util.List;
@@ -16,7 +18,7 @@
  * @since 2023-09-02
  */
 @RestController
-@RequestMapping("/url-permission")
+@RequestMapping("/urlPermission")
 public class UrlPermissionController {
 
     private final IUrlPermissionService urlPermissionServiceImpl;
@@ -24,5 +26,12 @@
     public UrlPermissionController(IUrlPermissionService urlPermissionServiceImpl){
         this.urlPermissionServiceImpl = urlPermissionServiceImpl;
     }
-
+    /**
+     * 根据id查询权限
+     */
+    @GetMapping("/findPermission/{id}")
+    public ResponseResult findPermission(@PathVariable("id") Long managerId) {
+        List<PermissionMenuVO> list = urlPermissionServiceImpl.findPermission(managerId);
+        return ResponseResult.ok(list);
+    }
 }
Index: parkingsys-operator/src/main/java/com/woniuxy/operator/OperatorApplication.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.woniuxy.operator;\r\n\r\nimport org.springframework.boot.SpringApplication;\r\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\r\n\r\n/**\r\n * @Description: OperatorApplication\r\n * @Version 1.0\r\n */\r\n@SpringBootApplication\r\npublic class OperatorApplication {\r\n    public static void main(String[] args) {\r\n        SpringApplication.run(OperatorApplication.class,args);\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/parkingsys-operator/src/main/java/com/woniuxy/operator/OperatorApplication.java b/parkingsys-operator/src/main/java/com/woniuxy/operator/OperatorApplication.java
--- a/parkingsys-operator/src/main/java/com/woniuxy/operator/OperatorApplication.java	
+++ b/parkingsys-operator/src/main/java/com/woniuxy/operator/OperatorApplication.java	
@@ -1,5 +1,6 @@
 package com.woniuxy.operator;
 
+import org.mybatis.spring.annotation.MapperScan;
 import org.springframework.boot.SpringApplication;
 import org.springframework.boot.autoconfigure.SpringBootApplication;
 
@@ -8,6 +9,7 @@
  * @Version 1.0
  */
 @SpringBootApplication
+@MapperScan("com.woniuxy.operator.mapper")
 public class OperatorApplication {
     public static void main(String[] args) {
         SpringApplication.run(OperatorApplication.class,args);
Index: parkingsys-operator/src/main/java/com/woniuxy/operator/vo/PageVO.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.woniuxy.operator.vo;\r\n\r\nimport lombok.AllArgsConstructor;\r\nimport lombok.Data;\r\nimport lombok.NoArgsConstructor;\r\n\r\nimport java.util.List;\r\n\r\n/**\r\n * @Description: PageVO\r\n * @Version 1.0\r\n */\r\n@Data\r\n@AllArgsConstructor\r\n@NoArgsConstructor\r\npublic class PageVO<T> {\r\n\r\n    private Long total;\r\n    private List<T> records;\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/parkingsys-operator/src/main/java/com/woniuxy/operator/vo/PageVO.java b/parkingsys-operator/src/main/java/com/woniuxy/operator/vo/PageVO.java
--- a/parkingsys-operator/src/main/java/com/woniuxy/operator/vo/PageVO.java	
+++ b/parkingsys-operator/src/main/java/com/woniuxy/operator/vo/PageVO.java	
@@ -1,6 +1,7 @@
 package com.woniuxy.operator.vo;
 
 import lombok.AllArgsConstructor;
+import lombok.Builder;
 import lombok.Data;
 import lombok.NoArgsConstructor;
 
@@ -13,6 +14,7 @@
 @Data
 @AllArgsConstructor
 @NoArgsConstructor
+@Builder
 public class PageVO<T> {
 
     private Long total;
Index: parkingsys-operator/src/main/java/com/woniuxy/operator/service/IUrlPermissionService.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.woniuxy.operator.service;\r\n\r\nimport com.woniuxy.operator.entity.UrlPermission;\r\nimport com.baomidou.mybatisplus.extension.service.IService;\r\n\r\n/**\r\n * <p>\r\n * 菜单和接口权限定义 服务类\r\n * </p>\r\n *\r\n * @author woniuxy\r\n * @since 2023-09-02\r\n */\r\npublic interface IUrlPermissionService extends IService<UrlPermission> {\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/parkingsys-operator/src/main/java/com/woniuxy/operator/service/IUrlPermissionService.java b/parkingsys-operator/src/main/java/com/woniuxy/operator/service/IUrlPermissionService.java
--- a/parkingsys-operator/src/main/java/com/woniuxy/operator/service/IUrlPermissionService.java	
+++ b/parkingsys-operator/src/main/java/com/woniuxy/operator/service/IUrlPermissionService.java	
@@ -2,6 +2,9 @@
 
 import com.woniuxy.operator.entity.UrlPermission;
 import com.baomidou.mybatisplus.extension.service.IService;
+import com.woniuxy.operator.vo.PermissionMenuVO;
+
+import java.util.List;
 
 /**
  * <p>
@@ -13,4 +16,5 @@
  */
 public interface IUrlPermissionService extends IService<UrlPermission> {
 
+    List<PermissionMenuVO> findPermission(Long managerId);
 }
Index: parkingsys-operator/src/main/java/com/woniuxy/operator/service/impl/UrlPermissionServiceImpl.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.woniuxy.operator.service.impl;\r\n\r\nimport com.woniuxy.operator.entity.UrlPermission;\r\nimport com.woniuxy.operator.mapper.UrlPermissionMapper;\r\nimport com.woniuxy.operator.service.IUrlPermissionService;\r\nimport com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;\r\nimport org.springframework.stereotype.Service;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\n/**\r\n * <p>\r\n * 菜单和接口权限定义 服务实现类\r\n * </p>\r\n *\r\n * @author woniuxy\r\n * @since 2023-09-02\r\n */\r\n@Service\r\npublic class UrlPermissionServiceImpl extends ServiceImpl<UrlPermissionMapper, UrlPermission> implements IUrlPermissionService {\r\n\r\n    private final UrlPermissionMapper urlPermissionMapper;\r\n\r\n    public UrlPermissionServiceImpl(UrlPermissionMapper urlPermissionMapper){\r\n        this.urlPermissionMapper = urlPermissionMapper;\r\n    }\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/parkingsys-operator/src/main/java/com/woniuxy/operator/service/impl/UrlPermissionServiceImpl.java b/parkingsys-operator/src/main/java/com/woniuxy/operator/service/impl/UrlPermissionServiceImpl.java
--- a/parkingsys-operator/src/main/java/com/woniuxy/operator/service/impl/UrlPermissionServiceImpl.java	
+++ b/parkingsys-operator/src/main/java/com/woniuxy/operator/service/impl/UrlPermissionServiceImpl.java	
@@ -4,8 +4,13 @@
 import com.woniuxy.operator.mapper.UrlPermissionMapper;
 import com.woniuxy.operator.service.IUrlPermissionService;
 import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
+import com.woniuxy.operator.vo.PermissionMenuVO;
 import org.springframework.stereotype.Service;
-import org.springframework.beans.factory.annotation.Autowired;
+
+import javax.validation.constraints.NotNull;
+import java.util.List;
+import java.util.stream.Collectors;
+
 /**
  * <p>
  * 菜单和接口权限定义 服务实现类
@@ -23,4 +28,40 @@
         this.urlPermissionMapper = urlPermissionMapper;
     }
 
+    public List<PermissionMenuVO> findPermission(Long managerId) {
+        List<UrlPermission> permissions = null;
+        if (managerId == 1) {//查询管理员，直接查询所有的权限数据 (系统默认：id = 1 就是超级管理员)
+            permissions = urlPermissionMapper.selectList(null);
+        } else {
+            permissions = urlPermissionMapper.listByManagerId(managerId);
+        }
+
+        return getPermissionMenuVOs(permissions);
+    }
+
+    @NotNull
+    private static List<PermissionMenuVO> getPermissionMenuVOs(List<UrlPermission> permissions) {
+        //先过滤一级菜单
+        List<UrlPermission> finalPermissions = permissions;
+        List<PermissionMenuVO> permissionMenuVOOne = permissions.stream()
+                .filter(e -> e.getParentId() == -1)
+                .map(e -> {
+                    PermissionMenuVO pmv = new PermissionMenuVO();
+                    pmv.setId(e.getId());
+                    pmv.setName(e.getName());
+                    //再过滤一次找到二级菜单，并放置到一级菜单中去
+                    List<PermissionMenuVO> children = finalPermissions.stream()
+                            .filter(m -> m.getParentId() == e.getId())
+                            .map(m -> {
+                                PermissionMenuVO pmvc = new PermissionMenuVO();
+                                pmvc.setId(m.getId());
+                                pmvc.setName(m.getName());
+                                pmvc.setUrl(m.getUrl());
+                                return pmvc;
+                            }).collect(Collectors.toList());
+                    pmv.setChildren(children);
+                    return pmv;
+                }).collect(Collectors.toList());
+        return permissionMenuVOOne;
+    }
 }
Index: parkingsys-operator/src/main/java/com/woniuxy/operator/mapper/UrlPermissionMapper.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.woniuxy.operator.mapper;\r\nimport org.apache.ibatis.annotations.Mapper;\r\nimport com.woniuxy.operator.entity.UrlPermission;\r\nimport com.baomidou.mybatisplus.core.mapper.BaseMapper;\r\n\r\n/**\r\n * <p>\r\n * 菜单和接口权限定义 Mapper 接口\r\n * </p>\r\n *\r\n * @author woniuxy\r\n * @since 2023-09-02\r\n */\r\n@Mapper\r\npublic interface UrlPermissionMapper extends BaseMapper<UrlPermission> {\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/parkingsys-operator/src/main/java/com/woniuxy/operator/mapper/UrlPermissionMapper.java b/parkingsys-operator/src/main/java/com/woniuxy/operator/mapper/UrlPermissionMapper.java
--- a/parkingsys-operator/src/main/java/com/woniuxy/operator/mapper/UrlPermissionMapper.java	
+++ b/parkingsys-operator/src/main/java/com/woniuxy/operator/mapper/UrlPermissionMapper.java	
@@ -3,6 +3,8 @@
 import com.woniuxy.operator.entity.UrlPermission;
 import com.baomidou.mybatisplus.core.mapper.BaseMapper;
 
+import java.util.List;
+
 /**
  * <p>
  * 菜单和接口权限定义 Mapper 接口
@@ -14,4 +16,5 @@
 @Mapper
 public interface UrlPermissionMapper extends BaseMapper<UrlPermission> {
 
+    List<UrlPermission> listByManagerId(Long managerId);
 }
Index: parkingsys-operator/src/main/resources/mapper/UrlPermissionMapper.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\r\n<mapper namespace=\"com.woniuxy.operator.mapper.UrlPermissionMapper\">\r\n\r\n</mapper>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/parkingsys-operator/src/main/resources/mapper/UrlPermissionMapper.xml b/parkingsys-operator/src/main/resources/mapper/UrlPermissionMapper.xml
--- a/parkingsys-operator/src/main/resources/mapper/UrlPermissionMapper.xml	
+++ b/parkingsys-operator/src/main/resources/mapper/UrlPermissionMapper.xml	
@@ -2,4 +2,15 @@
 <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.woniuxy.operator.mapper.UrlPermissionMapper">
 
+    <select id="listByManagerId" resultType="com.woniuxy.operator.entity.UrlPermission">
+        SELECT
+            up.*
+        FROM
+            url_permission up,manager_role mr,role_url_permission rup,role r
+        WHERE 1=1
+          and up.id = rup.url_permission_id
+          and rup.role_id = r.id
+          and mr.role_id = r.id
+          AND mr.manager_id = #{id}
+    </select>
 </mapper>
Index: parkingsys-operator/src/main/java/com/woniuxy/operator/config/WebMvcConfiguration.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.woniuxy.operator.config;\r\n\r\nimport com.woniuxy.operator.interceptor.LoginInterceptor;\r\nimport org.springframework.context.annotation.Bean;\r\nimport org.springframework.context.annotation.Configuration;\r\nimport org.springframework.web.servlet.config.annotation.InterceptorRegistry;\r\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.Collections;\r\nimport java.util.List;\r\n\r\n/**\r\n * @Description: WebMvcConfiguration\r\n * @Date 2023/8/10 19:35\r\n * @Version 1.0\r\n */\r\n@Configuration\r\npublic class WebMvcConfiguration implements WebMvcConfigurer {\r\n\r\n    @Bean\r\n    public LoginInterceptor loginInterceptor(){\r\n        return new LoginInterceptor();\r\n    }\r\n    @Override\r\n    public void addInterceptors(InterceptorRegistry registry) {\r\n        List<String> whiteList = new ArrayList<>();\r\n        //以后：swagger，druid 的一些请求，也需要放行\r\n        Collections.addAll(whiteList,\"/manager/login\",\"/token/refresh\",\"/**/druid/**\");\r\n        registry.addInterceptor(loginInterceptor()).addPathPatterns(\"/**\").excludePathPatterns(whiteList);\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/parkingsys-operator/src/main/java/com/woniuxy/operator/config/WebMvcConfiguration.java b/parkingsys-operator/src/main/java/com/woniuxy/operator/config/WebMvcConfiguration.java
--- a/parkingsys-operator/src/main/java/com/woniuxy/operator/config/WebMvcConfiguration.java	
+++ b/parkingsys-operator/src/main/java/com/woniuxy/operator/config/WebMvcConfiguration.java	
@@ -27,6 +27,6 @@
         List<String> whiteList = new ArrayList<>();
         //以后：swagger，druid 的一些请求，也需要放行
         Collections.addAll(whiteList,"/manager/login","/token/refresh","/**/druid/**");
-        registry.addInterceptor(loginInterceptor()).addPathPatterns("/**").excludePathPatterns(whiteList);
+//        registry.addInterceptor(loginInterceptor()).addPathPatterns("/**").excludePathPatterns(whiteList);
     }
 }
